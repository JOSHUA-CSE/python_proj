{% extends 'courses/base.html' %}

{% block title %}{{ course.title }} - Course Details{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header bg-info text-white">
        <h2>{{ course.title }}</h2>
    </div>
    <div class="card-body">
        <p>{{ course.description }}</p>
        <p><strong>Instructor:</strong> {{ course.instructor.username }}</p>
    </div>
</div>

{% if course.youtube_url %}
<div class="mb-4 text-center">
    <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;">
        <iframe src="https://www.youtube.com/embed/{{ course.youtube_url|cut:'https://www.youtube.com/watch?v='|cut:'https://youtu.be/' }}" frameborder="0" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
    </div>
</div>
{% endif %}

<h3>Quizzes</h3>
<ul>
    {% for quiz in quizzes %}
        <li>
            <a href="{% url 'quiz_detail' quiz.id %}">{{ quiz.title }}</a>
        </li>
    {% empty %}
        <li>No quizzes available for this course.</li>
    {% endfor %}
</ul>

<h3>Discussions</h3>
{% if main_discussion %}
<div class="card mb-4">
    <div class="card-header">
        <h4>Course Chat: {{ main_discussion.title }}</h4>
    </div>
    <div class="card-body" style="max-height: 300px; overflow-y: auto; background: #f9f9f9;">
        {% for comment in comments %}
            <div class="mb-2 p-2 rounded {% if comment.author == user %}bg-primary text-white ms-auto{% else %}bg-light{% endif %}" style="max-width: 70%; {% if comment.author == user %}margin-left:auto;{% endif %}">
                <strong>{{ comment.author.username }}</strong> <small class="text-muted">{{ comment.created_at|date:"H:i d/m/Y" }}</small><br>
                {{ comment.content }}
            </div>
        {% empty %}
            <p class="text-muted">No messages yet. Start the conversation!</p>
        {% endfor %}
    </div>
    <div class="card-footer">
        <form method="post">
            {% csrf_token %}
            <div class="input-group">
                <input type="text" name="content" class="form-control" placeholder="Type your message..." required>
                <button class="btn btn-primary" type="submit">Send</button>
            </div>
        </form>
    </div>
</div>
{% endif %}
{% endblock %} 